{% extends 'frontEnd/html/front_layouts.html' %}
{% load static %}
{% load hotel_info %}

{% block title %}Porzotok | Checkout{% endblock  %}

{% block custom_css %}
<link rel="stylesheet" href="{% static 'frontEnd/assets/customcss/checkout.css' %}">
{% endblock  %}

{% block main_content %}
<!-- ========== MAIN CONTENT ========== -->
<main id="content" class="bg-gray space-2" v-cloak>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-xl-8">
                <validation-observer v-slot="{ invalid, handleSubmit }">
                    <form id="validated-form" @submit.prevent="handleSubmit(onSubmit)">
                        <div v-show="step === 1" class="mb-5 shadow-soft bg-white rounded-sm">
                            <div class="py-3 px-4 px-xl-12 border-bottom">
                                <ul class="list-group flex-nowrap overflow-auto overflow-md-visble list-group-horizontal list-group-borderless flex-center-between pt-1">
                                    <li class="list-group-item text-center flex-shrink-0 flex-xl-shrink-1">
                                        <div class="flex-content-center mb-3 width-40 height-40 bg-logo border-width-2 border border-logo text-white mx-auto rounded-circle">
                                            1
                                        </div>
                                        <div class="text-logo-color">Customer information</div>
                                    </li>
                                    <li class="list-group-item text-center flex-shrink-0 flex-xl-shrink-1">
                                        <div class="flex-content-center mb-3 width-40 height-40 border  border-width-2 border-gray mx-auto rounded-circle">
                                            2
                                        </div>
                                        <div class="text-gray-1">Payment information</div>
                                    </li>
                                    <li class="list-group-item text-center flex-shrink-0 flex-md-shrink-1">
                                        <div class="flex-content-center mb-3 width-40 height-40 border  border-width-2 border-gray mx-auto rounded-circle">
                                            3
                                        </div>
                                        <div class="text-gray-1">Booking is confirmed!</div>
                                    </li>
                                </ul>
                            </div>

                            <div class="pt-4 pb-5 px-5">
                                <h5 id="scroll-description" class="font-size-21 font-weight-bold text-dark mb-4">
                                    Let us know who you are
                                </h5>
                                <!-- Contacts Form -->
                                <!-- <form class="js-validate"> -->

                                    <div class="row">
                                        <!-- Input -->
                                        <div class="col-sm-6 mb-4">
                                            <validation-provider name="Name" rules="required" v-slot="{ dirty, valid, invalid, errors }">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        Name <span class="text-danger">*</span>
                                                    </label>

                                                    <input id="name" v-model="name" type="text" class="form-control" name="name" placeholder="Enter Name" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" />
                                                </div>
                                                <div class="invalid-feedback d-inline-block" v-show="errors">${ errors[0] }</div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->


                                        <!-- Input -->
                                        <div class="col-sm-6 mb-4">
                                            <validation-provider name="Email Address" rules="required|email" v-slot="{ dirty, valid, invalid, errors }">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        Email <span class="text-danger">*</span>
                                                    </label>

                                                    <input v-model="email" type="email" class="form-control" name="email" placeholder="Enter Email Address"  required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" />
                                                </div>
                                                <div class="invalid-feedback d-inline-block" v-show="errors">${ errors[0] }</div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <!-- Input -->
                                        <div class="col-sm-6 mb-4">
                                            <validation-provider name="Mobile Number" rules="required" v-slot="{ dirty, valid, invalid, errors }">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        Mobile <span class="text-danger">*</span>
                                                    </label>

                                                    <input v-model="mobile" type="text" class="form-control" name="mobile" placeholder="Enter Mobile Number" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" />
                                                </div>
                                                <div class="invalid-feedback d-inline-block" v-show="errors">${ errors[0] }</div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <!-- Input -->
                                        <div class="col-sm-6 mb-4">
                                            <validation-provider name="NID Number" rules="required" v-slot="{ dirty, valid, invalid, errors }">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        National ID Number <span class="text-danger">*</span>
                                                    </label>

                                                    <input v-model="nid_number" type="text" class="form-control" name="nid_number" placeholder="Enter National ID Number" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" />
                                                </div>
                                                <div class="invalid-feedback d-inline-block" v-show="errors">${ errors[0] }</div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->


                                        <!-- Input -->
                                        <div class="col-sm-6 mb-4">
                                            <validation-provider name="Password" rules="required|min:6" v-slot="{ dirty, valid, invalid, errors }" vid="password">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        Password <span class="text-danger">*</span>
                                                    </label>

                                                    <input v-model="password" type="password" class="form-control" name="password" placeholder="Enter a Password" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" />
                                                </div>
                                                <div class="invalid-feedback d-inline-block" v-show="errors">${ errors[0] }</div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <!-- Input -->
                                        <div class="col-sm-6 mb-4">
                                            <validation-provider name="Confirm Password" rules="required|confirmed:password" v-slot="{ dirty, valid, invalid, errors }">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        Confirm Password <span class="text-danger">*</span>
                                                    </label>

                                                    <input v-model="password_confirmation" type="password" class="form-control" name="password_confirmation" placeholder="Enter Confirm Password" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" />
                                                </div>

                                                <div class="invalid-feedback d-inline-block" v-show="errors">${ errors[0] }</div>

                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <!-- Input -->
                                        <div class="col-sm-6 mb-4">
                                            <validation-provider rules="required" v-slot="{ dirty, valid, invalid, errors }">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        Date of Birth <span class="text-danger">*</span>
                                                    </label>

                                                    <input v-model="date_of_birth" type="date" class="form-control" name="date_of_birth" placeholder="Enter National ID Number" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" />
                                                </div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <!-- Input -->
                                        <div class="col-sm-6 mb-4">
                                            <validation-provider name="Gender" rules="required" v-slot="{ dirty, valid, invalid, errors }">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        Gender <span class="text-danger">*</span>
                                                    </label><br>
                                                    <input v-model="gender" type="radio" name="gender" value="1" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" /> Male
                                                    <input v-model="gender" type="radio" name="gender" value="2" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" /> Female
                                                    <input v-model="gender" type="radio" name="gender" value="3" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }" /> Other

                                                </div>
                                                <!-- <div class="invalid-feedback d-inline-block" v-show="errors">${ errors[0] }</div> -->
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <div class="w-100"></div>

                                        <!-- Input -->
                                        <div class="col-sm-4 mb-4">
                                            <validation-provider rules="required">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        Country <span class="text-danger">*</span>
                                                    </label>
                                                    <select v-model="country" @change="getStateByCountry" name="country" class="form-control dropdown-select" required="">
                                                        <option disabled value="">Select Country</option>
                                                        <option v-for="country in allCountries" :value="country.country_id">${ country.country_name }</option>
                                                    </select>
                                                </div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <!-- Input -->
                                        <div class="col-sm-4 mb-4">
                                            <validation-provider rules="required">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        State <span class="text-danger">*</span>
                                                    </label>
                                                    <select v-model="state" @change="getCityByState()" name="state" class="form-control dropdown-select" required="" >
                                                        <option disabled value="">Select State</option>
                                                        <option v-for="state in allStateList" :value="state.state_id">${ state.state_name }</option>
                                                    </select>
                                                </div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <!-- Input -->
                                        <div class="col-sm-4 mb-4">
                                            <validation-provider rules="required">
                                                <div class="js-form-message">
                                                    <label class="form-label">
                                                        City <span class="text-danger">*</span>
                                                    </label>
                                                    <select v-model="city" name="city" class="form-control dropdown-select" required="" >
                                                        <option disabled value="">Select City</option>
                                                        <option v-for="city in allCityList" :value="city.city_id">${ city.city_name }</option>
                                                    </select>
                                                </div>
                                            </validation-provider>
                                        </div>
                                        <!-- End Input -->

                                        <div class="w-100"></div>

                                        <div class="col">
                                            <!-- Input -->
                                            <validation-provider rules="required" v-slot="{ dirty, valid, invalid, errors }">
                                                <div class="js-form-message mb-6">
                                                    <label class="form-label">
                                                        Address <span class="text-danger">*</span>
                                                    </label>

                                                    <div class="input-group">
                                                        <textarea v-model="address" class="form-control" rows="4" name="address" placeholder="Enter Your Address" required :class="{ 'is-valid': dirty && valid, 'is-invalid': dirty && invalid }"></textarea>
                                                    </div>
                                                </div>
                                            </validation-provider>
                                            <!-- End Input -->
                                        </div>

                                        <div class="w-100"></div>

                                        <div class="col-sm-12 align-self-end">
                                            <div class="text-right">
                                                <button class="btn badge-primary btn-wide rounded-sm transition-3d-hover font-size-16 font-weight-bold py-3 next-button" :disabled="invalid" style="cursor: pointer;">NEXT</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    </form>
                </validation-observer>
                    <!-- End Contacts Form -->
                <div v-show="step === 2">
                    <div v-if="is_date_con == false" class="alert alert-danger">Please select check in and check out time.</div>
                    <div v-else-if="payment_id == 0" class="alert alert-danger">Please select a payment method.</div>
                    <form action="/confirm-booking/" method="POST">
                        {% csrf_token %}
                        <div class="mb-5 shadow-soft bg-white rounded-sm">
                            <div class="py-3 px-4 px-xl-12 border-bottom">
                                <ul class="list-group flex-nowrap overflow-auto overflow-md-visble list-group-horizontal list-group-borderless flex-center-between pt-1">
                                    <li class="list-group-item text-center flex-shrink-0 flex-xl-shrink-1">
                                        <div class="flex-content-center mb-3 width-40 height-40 border  border-width-2 bg-logo border-logo mx-auto text-white rounded-circle">
                                            1
                                        </div>
                                        <div class="text-logo-color">Customer information</div>
                                    </li>
                                    <li class="list-group-item text-center flex-shrink-0 flex-xl-shrink-1">
                                        <div class="flex-content-center mb-3 width-40 height-40 bg-logo border-width-2 border border-logo text-white mx-auto rounded-circle">
                                            2
                                        </div>
                                        <div class="text-logo-color">Payment information</div>
                                    </li>
                                    <li class="list-group-item text-center flex-shrink-0 flex-md-shrink-1">
                                        <div class="flex-content-center mb-3 width-40 height-40 border  border-width-2 border-gray mx-auto rounded-circle">
                                            3
                                        </div>
                                        <div class="text-gray-1">Booking is confirmed!</div>
                                    </li>
                                </ul>
                            </div>
                            <div class="pt-4 pb-5 px-5">
                                <h5 id="scroll-description" class="font-size-21 font-weight-bold text-dark mb-4">
                                    Your Payment Information
                                </h5>
                                <!-- Nav Classic -->
                                <ul class="nav nav-classic nav-choose border-0 nav-justified border mx-n3" role="tablist">
                                    
                                    <li v-for="payment in allPaymentTypes" class="nav-item mx-3" id="payment_type">
                                        <a @click="getPaymentId(payment.payment_method_id)" class="rounded py-5 border-width-2 border nav-link font-weight-medium" id="pills-two-example2-tab" data-toggle="pill" href="#pills-two-example2" role="tab" aria-controls="pills-two-example2" aria-selected="false">
                                            <div class="height-25 width-25 flex-content-center bg-logo rounded-circle position-absolute left-0 top-0 ml-2 mt-2">
                                                <i class="flaticon-tick text-white font-size-15"></i>
                                            </div>
                                            <div class="d-md-flex justify-content-md-center align-items-md-center flex-wrap">
                                                <img class="img-fluid mb-3" :src="payment.payment_method_image" :alt="payment.payment_method_name" style="height: 100px;">
                                                <div class="w-100 text-dark">${payment.payment_method_name}</div>
                                            </div>
                                        </a>
                                    </li>

                                </ul>
                                <!-- End Nav Classic -->

                                <!-- Tab Content -->
                                <div class="tab-content">
                                    <div class="tab-pane fade pt-8 show active" id="pills-one-example2" role="tabpanel" aria-labelledby="pills-one-example2-tab">

                                        <input type="hidden" name="user_id" :value="user_id">
                                        <input type="hidden" name="payment_id" :value="payment_id">
                                        <input type="hidden" name="cart_id_cookie" :value="cart_id_cookie">
                                        
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <button @click.prevent="prev()" class="btn badge-primary w-100 rounded-sm transition-3d-hover font-size-16 font-weight-bold py-3 prev-button">PREV</button>
                                            </div>
                                            <div v-if="is_date_con && payment_id != 0" class="col-sm-6">
                                                <input type="submit" name="confirm_booking" class="btn badge-primary w-100 rounded-sm transition-3d-hover font-size-16 font-weight-bold py-3" value="CONFIRM BOOKING" />
                                            </div>
                                            <div v-else class="col-sm-6">
                                                <input type="submit" name="confirm_booking" class="btn badge-primary w-100 rounded-sm transition-3d-hover font-size-16 font-weight-bold py-3" value="CONFIRM BOOKING" disabled="" />
                                            </div>
                                        </div>
                                        
                                    </div>


                                </div>
                                <!-- End Tab Content -->
                            </div>
                        </div>
                    </form> 
                </div>

            </div>


            <div class="col-lg-4 col-xl-4">
                <div class="shadow-soft bg-white rounded-sm">

                    <div class="pt-5 pb-3 px-5 border-bottom" v-if="userCartDetails.cart_room_data">
                        <a href="javascript:" class="d-block mb-3">
                            <img class="img-fluid rounded-sm" :src="userCartDetails.cart_room_data[0].hotels.image_url[0].Image" alt="userCartDetails.cart_room_data[0].hotels.hotel_name">
                        </a>
                        <a href="javascript:" class="text-dark font-weight-bold mb-2 d-block">${ userCartDetails.cart_room_data[0].hotels.hotel_name }</a>
                        <div class="mb-1 flex-horizontal-center text-gray-1">
                            <i class="icon flaticon-pin-1 mr-2 font-size-15"></i> ${ userCartDetails.cart_room_data[0].hotels.city_id.city_name }, ${ userCartDetails.cart_room_data[0].hotels.city_id.state.country.country_name }
                        </div>
                    </div>

                    <!-- Basics Accordion -->
                    <div id="basicsAccordion" >
                        <!-- Card -->
                        <div class="card rounded-0 border-top-0 border-left-0 border-right-0">
                            <div class="card-header card-collapse bg-transparent border-0" id="basicsHeadingOne">
                                <h5 class="mb-0">
                                    <button type="button" class="btn btn-link border-0 btn-block d-flex justify-content-between card-btn py-3 font-size-17 font-weight-bold text-dark"
                                        data-toggle="collapse"
                                        data-target="#basicsCollapseOne"
                                        aria-expanded="true"
                                        aria-controls="basicsCollapseOne">
                                        Booking Detail

                                        <span class="card-btn-arrow font-size-14 text-dark">
                                            <i class="fas fa-chevron-down"></i>
                                        </span>
                                    </button>
                                </h5>
                            </div>
                            <div id="basicsCollapseOne" class="collapse show"
                                aria-labelledby="basicsHeadingOne"
                                data-parent="#basicsAccordion">

                                <div v-for="userRoomCart in userCartDetails['cart_room_data']" class="card-body px-4 pt-0" style="border-bottom: 1px solid #ddd">
                                    <!-- Fact List -->
                                    <ul class="list-unstyled font-size-1 mb-0 font-size-16">
                                        
                                        <li class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Room Number:</span> 
                                            <span class="text-secondary">${userRoomCart.room_details.room_no}</span>
                                        </li>

                                        <li v-if="userRoomCart.check_in_date" class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Check In Time:</span> 
                                            <span class="text-secondary">${userRoomCart.check_in_date}</span>
                                        </li>
                                        <li v-else class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Check In Time:</span> 
                                            <input type="date" v-model="check_in_date" name="check_in_date" style=" border:none;">
                                        </li>

                                        <li v-if="userRoomCart.check_out_date" class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Check Out Time:</span> 
                                            <span class="text-secondary">${userRoomCart.check_out_date}</span>
                                        </li>
                                        <li v-else class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Check Out Time:</span> 
                                            <input v-model="check_out_date" @change="checkInOutTimeChange(userRoomCart.room_cart_details_id)" type="date" name="check_out_date" style=" border:none;">
                                        </li>

                                        <li v-if="userRoomCart.total_day != 0" class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Duration:</span> <span class="text-secondary">${userRoomCart.total_day} Days</span>
                                        </li>

                                        <li v-else class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Duration:</span>
                                            <span class="text-secondary">${ total_day } Days</span>
                                        </li>

                                        <li class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Room Price(Night):</span>
                                            <span class="text-secondary">${userRoomCart.room_details.price_details.offer_price} TK</span>
                                        </li>

                                    </ul>
                                    <!-- End Fact List -->
                                </div>

                            </div>
                        </div>
                        <!-- End Card -->


                        <!-- Card -->
                        <div class="card rounded-0 border-top-0 border-left-0 border-right-0">
                            <div class="card-header card-collapse bg-transparent border-0" id="basicsHeadingFour">
                                <h5 class="mb-0">
                                    <button type="button" class="btn btn-link border-0 btn-block d-flex justify-content-between card-btn py-3 px-4 font-size-17 font-weight-bold text-dark"
                                        data-toggle="collapse"
                                        data-target="#basicsCollapseFour"
                                        aria-expanded="false"
                                        aria-controls="basicsCollapseFour">
                                        Payment

                                        <span class="card-btn-arrow font-size-14 text-dark">
                                            <i class="fas fa-chevron-down"></i>
                                        </span>
                                    </button>
                                </h5>
                            </div>
                            <div id="basicsCollapseFour" class="collapse show"
                                aria-labelledby="basicsHeadingFour"
                                data-parent="#basicsAccordion">
                                <div class="card-body px-4 pt-0">
                                    <!-- Fact List -->
                                    <ul class="list-unstyled font-size-1 mb-0 font-size-16">

                                        <li class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Room Price</span>
                                            <span class="text-secondary" v-if="userCartDetails.cart_room_data && userCartDetails.cart_room_data.length > 0">${total_price } TK</span>
                                        </li>

                                        <li class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Subtotal</span>
                                            <span class="text-secondary" v-if="userCartDetails.cart_room_data && userCartDetails.cart_room_data.length > 0">${total_price} TK</span>
                                        </li>

                                        <li class="d-flex justify-content-between py-2">
                                            <span class="font-weight-medium">Tax (0%)</span>
                                            <span class="text-secondary">${tax} TK</span>
                                        </li>

                                        <li class="d-flex justify-content-between py-2 font-size-17 font-weight-bold">
                                            <span class="font-weight-bold">Total Amount</span>
                                            <span class="text-secondary" v-if="userCartDetails.cart_room_data && userCartDetails.cart_room_data.length > 0">${total_price} TK</span>
                                        </li>
                                    </ul>
                                    <!-- End Fact List -->
                                </div>
                            </div>
                        </div>
                        <!-- End Card -->
                    </div>
                    <!-- End Basics Accordion -->
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}


        <!-- ========== END MAIN CONTENT ========== -->
{% block custom_js %}
    <script src="{% static 'frontEnd/assets/js/customjs/vee-validate.min.js' %}"></script>

    <script>
        Vue.component('validation-observer', VeeValidate.ValidationObserver);
        Vue.component('validation-provider', VeeValidate.ValidationProvider);
    </script>
    <script src="{% static 'frontEnd/assets/js/customjs/rules.umd.js' %}"></script>
    <script>
        Object.keys(VeeValidateRules).forEach(rule => {
          VeeValidate.extend(rule, VeeValidateRules[rule]);
        });
    </script>

    <script type="text/javascript">
        Vue.http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";
    </script>
    <!-- vue js scripts start -->
    <script type="text/javascript">

        new Vue({
            el: '#content',
            delimiters: ['${','}'],
            data: {
                allCountries: [],
                allStateList: [],
                allCityList: [],
                step: 1,
                name: null,
                gender: 1,
                email: null,
                mobile: null,
                password: '',
                password_confirmation: '',
                nid_number: null,
                date_of_birth: null,
                country: '',
                state: '',
                city: '',
                address: null,
                userCartDetails: [],
                session_id: "{{ request.session.session_id }}",
                user_id: "{{ request.session.user_id }}",
                user_name: "{{ request.session.user_name }}",
                type: "{{ request.session.type }}",
                time: "{{ request.session.time }}",
                isLogin: "{{ request.session.isLogin }}",
                tax: 0,
                isRegistered: true,
                allPaymentTypes: [],
                payment_id: 0,
                cart_id: 0,
                confirm_booking: false,
                cart_id_cookie: 0,
                userDetails: {},
                is_date_con: false,
                check_in_date: "",
                check_out_date: "",
                errors: [],
                total_day : 0,
                total_price : 0,
            },
            mounted: function() {
                this.getAllCountries();
                this.getUserCartDetails();
                this.getAllPaymentTypes();
                this.getUserDetails();
                if(this.isLogin != ""){
                    this.isLogin = JSON.parse("{{ request.session.isLogin }}".toLowerCase());
                    this.step++;
                }
                this.cart_id_cookie = localStorage.getItem('cart_id');
                this.checkConfirmTime();
            },
            computed: {
                totalPrice: function(room_id){
                    var sum = 0;
                    this.userCartDetails.cart_room_data.forEach(item => {
                        sum += parseInt(item.room_details.price_details.offer_price);
                    });
                    this.getUserCartDetails();
                    return sum;
                },


            },
            methods: {
                checkConfirmTime: function(){
                    this.$http.get(`/api/check-booking-date/?cart_id=${this.cart_id_cookie}`)
                        .then((resp) => {
                            this.is_date_con = resp.data.status;
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                },
                getAllCountries: function() {

                    this.$http.get(`/api/country/`)
                        .then((resp) => {
                            this.allCountries = resp.data;
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                },
                getStateByCountry: function(){
                    this.$http.get(`/api/state_by_country/${this.country}`)
                      .then((resp) => {
                        this.allStateList = resp.data;
                      })
                      .catch((err) => {
                        console.log(err);
                    })
                },
                getCityByState: function(){
                    this.$http.get(`/api/city_by_state/${this.state}`)
                      .then((resp) => {
                        this.allCityList = resp.data;
                      })
                      .catch((err) => {
                        console.log(err);
                    })
                },
                prev() {
                    this.step--;
                },
                getUserCartDetails: function(){
                    if (this.user_id != 0) {
                        this.$http.get(`/api/user-cart-details/?u_id=${this.user_id}`)
                        .then((resp) => {
                            this.userCartDetails = resp.data.data;
                            this.cart_id = this.userCartDetails.cart_id;
                            for(var price = 0; price < this.userCartDetails.cart_room_data.length; price++){
                                var newVal = parseInt(this.userCartDetails.cart_room_data[price].room_details.price_details.offer_price);
                                var daysWithAmo = this.userCartDetails.cart_room_data[price].total_day * newVal
                                this.total_price += daysWithAmo;
                            }
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                    } else {
                        this.$http.get(`/api/user-cart-details/?session_id=${this.session_id}`)
                        .then((resp) => {
                            this.userCartDetails = resp.data.data;
                            this.cart_id = this.userCartDetails.cart_id;
                            for(var price = 0; price < this.userCartDetails.cart_room_data.length; price++){
                                var newVal = parseInt(this.userCartDetails.cart_room_data[price].room_details.price_details.offer_price);
                                var daysWithAmo = this.userCartDetails.cart_room_data[price].total_day * newVal
                                this.total_price += daysWithAmo;
                            }
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                    }
                },
                getUserDetails: function(){
                    if (this.user_id != 0) {
                        this.$http.get(`/api/user-details/${this.user_id}/`)
                        .then((resp) => {
                            this.userDetails = resp.data.data;
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                    }
                },
                // calculateTotalDay: function(s_date, end_date){
                //     var start_date = new Date(s_date);
                //     var end_date = new Date(end_date);
                //     var diff = end_date.getDate() - start_date.getDate();
                //     this.total_day =  diff;
                //     return diff;
                // },
                onSubmit: function() {
                    if (this.isRegistered) {
                        // save customer personal information
                        this.savePersonalInfo()
                        this.isRegistered = false;
                    }else{
                        this.step++;
                    }
                },
                savePersonalInfo: function(){
                    let form_data = new FormData();
                    form_data.append('name', this.name);
                    form_data.append('email', this.email);
                    form_data.append('mobile', this.mobile);
                    form_data.append('password', this.password);
                    form_data.append('nid_number', this.nid_number);
                    form_data.append('date_of_birth', this.date_of_birth);
                    form_data.append('gender', this.gender);
                    form_data.append('city', this.city);
                    form_data.append('address', this.address);
                    this.$http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";

                    this.$http.post(`/user-register/`, form_data)
                        .then((resp) => {
                            if (resp.data.data.isLogin === true) {
                                this.user_id = resp.data.data.user_id;
                                this.user_name = resp.data.data.user_name;
                                this.type = resp.data.data.type;
                                this.time = resp.data.data.time;
                                this.isLogin = resp.data.data.isLogin;
                                let data = {'user_id': `${resp.data.data.user_id}`, 'session_id': `${this.session_id}`};
                                let js_cartDetails = JSON.stringify(data);
                                this.updateUserCart(js_cartDetails);
                                this.step++;
                                return true;
                            }else{
                                return false;
                            }
 
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                },
                updateUserCart: function(js_cartDetails){
                    var cart_id = localStorage.getItem('cart_id');
                    this.$http.put(`/api/carts/${cart_id}/`, js_cartDetails)
                        .then((resp) => {
                            console.log("");
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                    return true;
                },
                getAllPaymentTypes: function(){
                    this.$http.get(`/api/payment/`)
                        .then((resp) => {
                            this.allPaymentTypes = resp.data.data;
                        })
                        .catch((err) => {
                            console.log(err);
                        })
                },
                getPaymentId: function(p_id){
                    this.payment_id = p_id;
                },
                checkInOutTimeChange: function(room_cart_id){
                    var start_date = new Date(this.check_in_date);
                    var end_date = new Date(this.check_out_date);
                    this.total_day = end_date.getDate() - start_date.getDate();
                    
                    if (this.check_in_date != "" && this.check_out_date != "") {
                        data = JSON.stringify({'check_in_date': this.check_in_date, 'check_out_date': this.check_out_date, 'cart_id': this.cart_id_cookie})
                        this.$http.put(`/api/cart-details/${room_cart_id}/`, data)
                            .then((resp) => {
                                if(resp.data.error == true){
                                    iziToast.show({
                                        title: 'Opppps!',
                                        position: 'topRight',
                                        timeout: 2000,
                                        color: 'red',
                                        message: resp.data.message,
                                        messageColor: 'black'
                                    });
                                }else{
                                    this.getUserCartDetails();
                                    iziToast.show({
                                        title: 'Success!',
                                        position: 'topRight',
                                        timeout: 2000,
                                        color: 'green',
                                        message: resp.data.message,
                                        messageColor: 'black'
                                    });
                                }
                                this.checkConfirmTime();
                            })
                            .catch((err) => {
                                console.log(err);
                            })
                    }
                    
                }
                
            }
        });
    </script>
    <!-- vue js scripts end -->    

{% endblock %}
